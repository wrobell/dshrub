<html>

<link rel='stylesheet' type='text/css' href='dashboard.css'></link>

<script type='text/javascript' src='jquery-2.1.1.js'></script>
<script type='text/javascript' src='jquery.flot.js'></script>
<script type='text/javascript' src='jquery.flot.time.js'></script>
<script type='text/javascript'>
function DataView(name) {
    this.name = name;
    this.div_id = '#plot-' + name;
    this.plot_params = {
        xaxis: {mode: 'time'},
        'shadowSize': 0,
        'points': {
            'show': true,
            'fillColor': 'black',
            'lineWidth': 0,
            'radius': 2,
        },
    };
    this.plot = $.plot($('#plot-' + name), [[]], this.plot_params);
    this.data = new Array();
}

DataView.prototype.add = function(x, y) {
    this.data.push([x, y]);
    if (this.data.length > 24 * 3600)
        this.data.shift();
}

DataView.prototype.draw = function() {
    this.plot.setData([this.data]);
    this.plot.setupGrid();
    this.plot.draw();
}

function create_view(title, name) {
    $('#dashboard').append(
        '<h3>' + title + '</h3>'
        + '<div id="plot-' + name + '" class="data-plot"></div>'
    );
    return new DataView(name);
}

$(document).ready(function() {
    var source = new EventSource('/data');
    var plots = new Array();
    //plots['temperature'] = create_view('Temperature', 'temperature');
    plots['light'] = create_view('Light', 'light');
    plots['humidity'] = create_view('Humidity', 'humidity');

    source.onmessage = function (event) {
        value = JSON.parse(event.data);
        name = value['name'];
        plot = plots[name];

        x = new Date(value['time'] * 1000);
        y = value['value'];
        plot.add(x, y);
        plot.draw();
    };
})

</script>

<body>
<div id='dashboard'>
</div>
</body>
</html>
