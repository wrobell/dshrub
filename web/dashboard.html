<html>

<link rel='stylesheet' type='text/css' href='dashboard.css'></link>

<script type='text/javascript' src='jquery-2.1.1.js'></script>
<script type='text/javascript' src='jquery.flot.js'></script>
<script type='text/javascript' src='jquery.flot.time.js'></script>
<script type='text/javascript' src='dashboard.js'></script>
<script type='text/javascript'>
$(document).ready(function() {
    var plots = new Array();

    $.ajax('/conf')
        .done(function(config) {
            console.log('loaded config')

            for (var i = 0; i < config['data'].length; i++) {
                name = config['data'][i];
                plot = create_view(name);
                response = $.ajax({
                    url: '/data/last/' + name,
                    name: name,
                    plot: plot,
                    success: function(data) {
                        console.log(
                            'received initial data for ' + this.name + ', size=' + data.length
                        );
                        for (var j = 0; j < data.length; j++)
                            plot_add_item(this.plot, data[j]);
                        panel_set_item_value(this.name, data[data.length - 1]);
                        this.plot.draw();
                    }
                });

                plots[name] = plot;
                console.log('added plot for ' + name);
            }

            source = new EventSource('/data');
            source.onmessage = function(event) {
                value = JSON.parse(event.data);
                name = value['name'];
                plot = plots[name];

                if (plot === undefined)
                    console.log('no data feed configured for ' + name);
                else {
                    plot_add_item(plot, value);
                    panel_set_item_value(name, value);
                }
            };
        });
})

</script>

<body>
<div id='dashboard'>
</div>
</body>
</html>
